{% extends "base.html" %}

{% block title %}Горки Ленинские{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='styles/homepage.css') }}">
{% endblock %}

{% block content %}


    <!-- Homepage -->
    <homepage class="homepage">
        <!-- Heroe section -->
        <section class="hero-section">
            <!-- Background Rectangle -->
            <div class="hero-background" id="heroBackground"></div>

            <!-- Left Navigation Button -->
            <button class="hero-button-left" id="heroPrev">
                <span class="chevron-left">←</span>
            </button>

            <!-- Right Navigation Button -->
            <button class="hero-button-right" id="heroNext">
                <span class="chevron-right">→</span>
            </button>

            <!-- Slide Indicators -->
            <div class="hero-indicators"></div>
        </section>


        <!-- Museum section -->
        <section class="museum-section">
            <!-- Section Title -->
            <h2 class="museum-title">Музеи</h2>

            <!-- Museum Cards -->
            <div class="museum-cards">
                {% for museum in museums %}
                <div class="museum-card">
                    <!-- Контейнер для картинки и темного блока с текстом -->
                    <div class="museum-content-wrapper">
                        <img src="{{ url_for('static', filename=museum.img_card) }}"
                             alt="{{ museum.title_card }}"
                             class="museum-card-image"
                             loading="lazy"
                             decoding="async">

                        <div class="museum-card-info">
                            <div class="museum-card-header">
                                <h3 class="museum-card-title">{{ museum.title_card }}</h3>
                                <div class="museum-badges">
                                    <span class="museum-badge">0+</span>
                                    <span class="museum-badge">от 800 ₽</span>
                                </div>
                            </div>
                            <p class="museum-card-description">
                                {{ museum.short_description_card }}
                            </p>
                        </div>
                    </div>

                    <!-- Кнопки -->
                    <div class="museum-card-buttons">
                        <a href="{{ url_for('about_us', museum_id=museum.id) }}" class="museum-card-button">Подробнее</a>
                        <a href="{{ url_for('order', museum_id=museum.id) }}" class="museum-card-button">Купить билет</a>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Navigation -->
            <div class="museum-navigation">
                <button class="museum-nav-button prev">
                    <svg viewBox="0 0 24 24" fill="none">
                        <path d="M15 18L9 12L15 6" stroke="#251E1E" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </button>
                <span class="museum-nav-counter">1 / 2</span>
                <button class="museum-nav-button next">
                    <svg viewBox="0 0 24 24" fill="none">
                        <path d="M9 18L15 12L9 6" stroke="#251E1E" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </button>
            </div>
        </section>


        <!-- Virtual exhibitions section -->
        <section class="virtual-exhibitions">
            <!-- Section Title -->
            <h2 class="virtual-exhibitions-title">Виртуальные выставки</h2>

            <!-- Virtual Exhibition Cards -->
            <div class="virtual-exhibitions-cards">
                {% for exhibition in virtual_exhibitions %}
                <div class="virtual-exhibition-card">
                    <img src="{{ url_for('static', filename=exhibition.img_card) }}"
                         alt="{{ exhibition.title_card or 'Виртуальная выставка' }}"
                         class="virtual-exhibition-card-image"
                         loading="lazy"
                         decoding="async">

                    <a href="{{ url_for('virtual_exhibition') }}" class="virtual-exhibition-card-button">Подробнее</a>
                </div>
                {% endfor %}
            </div>

            <!-- Navigation -->
            <div class="virtual-exhibitions-navigation">
                <button class="virtual-exhibitions-nav-button prev">
                    <svg viewBox="0 0 24 24" fill="none">
                        <path d="M15 18L9 12L15 6" stroke="#251E1E" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </button>
                <span class="virtual-exhibitions-nav-counter">1 / 2</span>
                <button class="virtual-exhibitions-nav-button next">
                    <svg viewBox="0 0 24 24" fill="none">
                        <path d="M9 18L15 12L9 6" stroke="#251E1E" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </button>
            </div>
        </section>

        <!-- Poster section -->
        <section class="poster-section">
            <!-- Section Title -->
            <h2 class="poster-title">Афиша</h2>

            <!-- Poster Cards -->
            <div class="poster-cards">
                {% for event in events %}
                <div class="poster-card">
                    <!-- Верхняя часть: Картинка -->
                    <div class="poster-image-container">
                        <img src="{{ url_for('static', filename=event.img_card) }}"
                             alt="{{ event.title_card }}"
                             class="poster-card-image"
                             loading="lazy"
                             decoding="async">
                    </div>

                    <!-- Нижняя часть: Контент -->
                    <div class="poster-card-content">
                        <h3 class="poster-card-title">{{ event.title_card }}</h3>

                        <p class="poster-card-description">
                            {{ event.short_description_card }}
                        </p>

                        <!-- Пунктирный разделитель -->
                        <div class="poster-divider"></div>

                        <!-- Дата и время -->
                        <div class="poster-meta">
                            <span class="poster-icon calendar-icon"></span>
                            <span class="poster-meta-text">{{ event.date_of_the_event }}</span>
                        </div>

                        <!-- Место проведения -->
                        <div class="poster-meta">
                            <span class="poster-icon location-icon"></span>
                            <span class="poster-meta-text">{{ event.location_of_the_event }}</span>
                        </div>

                        <!-- Ссылка -->
                        <a href="{{ url_for('poster') }}" class="poster-link">
                            Узнать подробнее ↗
                        </a>

                        <!-- Штрих-код -->
                        <div class="poster-barcode"></div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Navigation -->
            <div class="poster-navigation">
                <button class="poster-nav-button prev">
                    <svg viewBox="0 0 24 24" fill="none">
                        <path d="M15 18L9 12L15 6" stroke="#251E1E" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </button>
                <span class="poster-nav-counter">1 / 2</span>
                <button class="poster-nav-button next">
                    <svg viewBox="0 0 24 24" fill="none">
                        <path d="M9 18L15 12L9 6" stroke="#251E1E" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </button>
            </div>
        </section>


        <!-- Map section -->
        <section class="map-section">
            <!-- Section Title -->
            <h2 class="map-title">Как добраться</h2>

            <!-- Map Container -->
            <div class="map-container">
                <!-- Text Content Side -->
                <div class="map-content">
                    <div class="map-info-row">
                        <!-- General Questions -->
                        <div class="map-info-block">
                            <h3 class="map-info-header">По общим вопросам</h3>
                            <div class="map-info-text">
                                <a href="tel:+74959570727">+7 (495) 957 07 27</a>
                                <a href="tel:+74959570700">+7 (495) 957 07 00</a>
                                <p>ВТ, СР, ВС: 10:00 — 18:00</p>
                                <p>ЧТ, ПТ, СБ: 10:00 — 21:00</p>
                            </div>
                        </div>

                        <!-- Excursions Information -->
                        <div class="map-info-block">
                            <h3 class="map-info-header">Экскурсии</h3>
                            <div class="map-info-text">
                                <a href="tel:+74959570727">+7 (495) 957-07-27, доб.4</a>
                                <p>ВТ, СР: 10:00 — 17:00</p>
                                <p>ЧТ, ПТ, СБ: 10:00 — 19:00</p>
                            </div>
                        </div>
                    </div>

                    <!-- Address -->
                    <div class="map-address-block">
                        <h3 class="map-info-header">Адрес</h3>
                        <p class="map-address-text">
                            142712, Московская область, городской округ Ленинский, посёлок городского типа Горки Ленинские, улица Центральная, дом 1
                        </p>
                    </div>
                </div>

                <!-- Image Side -->
                <div class="map-image-wrapper">
                    <img src="../static/images/img/888.jpg"
                         alt="Карта расположения"
                         class="map-image"
                         loading="lazy"
                         decoding="async">
                </div>
            </div>
        </section>


    <!-- Hero Slider Script -->
    <script>
        // Hero slider functionality
        const heroBackground = document.getElementById('heroBackground');
        const heroPrev = document.getElementById('heroPrev');
        const heroNext = document.getElementById('heroNext');
        const indicatorsContainer = document.querySelector('.hero-indicators');

        const heroImages = [
            '../static/images/hero/Page_1.jpg',
            '../static/images/hero/Page_2.jpg',
            '../static/images/hero/Page_3.jpg',
            '../static/images/hero/Page_4.jpg'
        ];

        indicatorsContainer.innerHTML = '';

        heroImages.forEach((_, index) => {
            const dot = document.createElement('span');
            dot.classList.add('hero-indicator');
            if (index === 0) dot.classList.add('active');

            dot.addEventListener('click', () => {
                updateSlide(index);
            });

            indicatorsContainer.appendChild(dot);
        });

        const heroIndicators = document.querySelectorAll('.hero-indicator');
        let currentSlide = 0;

        function updateSlide(index) {
            // Update background image
            heroBackground.style.opacity = '0';

            setTimeout(() => {
                heroBackground.style.backgroundImage = `url('${heroImages[index]}')`;
                heroBackground.style.opacity = '1';
                currentSlide = index;

                // Update indicators
                heroIndicators.forEach((indicator, i) => {
                    if (i === index) {
                        indicator.classList.add('active');
                    } else {
                        indicator.classList.remove('active');
                    }
                });
            }, 250);
        }

        function nextSlide() {
            const next = (currentSlide + 1) % heroImages.length;
            updateSlide(next);
        }

        function prevSlide() {
            const prev = (currentSlide - 1 + heroImages.length) % heroImages.length;
            updateSlide(prev);
        }

        // Event listeners
        heroNext.addEventListener('click', nextSlide);
        heroPrev.addEventListener('click', prevSlide);

        heroIndicators.forEach((indicator, index) => {
            indicator.addEventListener('click', () => {
                updateSlide(index);
            });
        });

        // Auto-play (optional - every 5 seconds)
        let autoPlayInterval = setInterval(nextSlide, 5000);

        // Pause auto-play on hover
        const heroSection = document.querySelector('.hero-section');
        heroSection.addEventListener('mouseenter', () => {
            clearInterval(autoPlayInterval);
        });

        heroSection.addEventListener('mouseleave', () => {
            autoPlayInterval = setInterval(nextSlide, 5000);
        });

        document.addEventListener('DOMContentLoaded', function() {

        const slidersConfig = [
            {
                containerSelector: '.museum-cards',
                cardSelector: '.museum-card',
                prevBtnSelector: '.museum-navigation .prev',
                nextBtnSelector: '.museum-navigation .next',
                counterSelector: '.museum-nav-counter'
            },
            {
                containerSelector: '.virtual-exhibitions-cards',
                cardSelector: '.virtual-exhibition-card',
                prevBtnSelector: '.virtual-exhibitions-navigation .prev',
                nextBtnSelector: '.virtual-exhibitions-navigation .next',
                counterSelector: '.virtual-exhibitions-nav-counter'
            },
            {
                containerSelector: '.poster-cards',
                cardSelector: '.poster-card',
                prevBtnSelector: '.poster-navigation .prev',
                nextBtnSelector: '.poster-navigation .next',
                counterSelector: '.poster-nav-counter'
            }
        ];

        function initSlider(config) {
            const container = document.querySelector(config.containerSelector);
            if (!container) return;

            const cards = Array.from(container.querySelectorAll(config.cardSelector));
            const prevBtn = document.querySelector(config.prevBtnSelector);
            const nextBtn = document.querySelector(config.nextBtnSelector);
            const counter = document.querySelector(config.counterSelector);

            if (!cards.length || !prevBtn || !nextBtn) return;

            const itemsPerPage = 3;
            let currentPage = 1;
            const totalPages = Math.ceil(cards.length / itemsPerPage);

            const updateView = () => {
                // 1. Сначала скрываем счетчик, чтобы он "мигнул" при смене
                if(counter) {
                    counter.classList.add('counter-fade');
                    setTimeout(() => {
                        counter.textContent = `${currentPage} / ${totalPages}`;
                        counter.classList.remove('counter-fade');
                    }, 200);
                }

                // 2. Скрываем все карточки
                cards.forEach(card => {
                    card.style.display = 'none';
                    card.classList.remove('animating'); // Убираем класс анимации
                    card.style.animationDelay = '0s'; // Сбрасываем задержку
                });

                // 3. Вычисляем текущие карточки
                const startIndex = (currentPage - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;
                const visibleCards = cards.slice(startIndex, endIndex);

                // 4. Показываем их с анимацией
                visibleCards.forEach((card, index) => {
                    card.style.display = ''; // Восстанавливаем display (flex/block) из CSS

                    // Магия перезапуска CSS анимации
                    void card.offsetWidth;

                    // Добавляем класс анимации
                    card.classList.add('animating');

                    // Добавляем задержку: 0ms для первой, 100ms для второй, 200ms для третьей
                    // Это создает эффект "лесенки" (каскада)
                    card.style.animationDelay = `${index * 0.1}s`;
                });
            };

            nextBtn.addEventListener('click', (e) => {
                e.preventDefault();
                currentPage = (currentPage < totalPages) ? currentPage + 1 : 1;
                updateView();
            });

            prevBtn.addEventListener('click', (e) => {
                e.preventDefault();
                currentPage = (currentPage > 1) ? currentPage - 1 : totalPages;
                updateView();
            });

            // Инициализация
            updateView();
        }

        slidersConfig.forEach(config => initSlider(config));
    });
    </script>


    </homepage>

{% endblock %}