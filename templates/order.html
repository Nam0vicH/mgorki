{% extends "base.html" %}

{% block title %}–ü–æ–∫—É–ø–∫–∞ –±–∏–ª–µ—Ç–æ–≤ - –ì–æ—Ä–∫–∏ –õ–µ–Ω–∏–Ω—Å–∫–∏–µ{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='styles/homepage.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='styles/order.css') }}">
{% endblock %}

{% block content %}

    <!-- Order Page Container -->
    <div class="order-page-container">
        <!-- Page Title -->
        <h1 class="title">–ü–æ–∫—É–ø–∫–∞ –±–∏–ª–µ—Ç–æ–≤</h1>

        <!-- Main Content -->
        <div class="main-content">
        <!-- Left Section -->
        <div class="left-section">
            <!-- Museum Info -->
            <div class="museum-info">
                <div class="museum-title">{{ museum.title_card }}</div>
                <div class="museum-description">
                    {{ museum.short_description_card }}
                </div>
            </div>

            <!-- Calendar -->
            <div class="calendar-section">
                <div class="calendar-grid">
                    <!-- –ó–∞–≥–æ–ª–æ–≤–∫–∏ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏ -->
                    <div class="calendar-day-header">–ü–ù</div>
                    <div class="calendar-day-header">–í–¢</div>
                    <div class="calendar-day-header">–°–†</div>
                    <div class="calendar-day-header">–ß–¢</div>
                    <div class="calendar-day-header">–ü–¢</div>
                    <div class="calendar-day-header weekend">–°–ë</div>
                    <div class="calendar-day-header weekend">–í–°</div>

                    <!-- –î–∞—Ç—ã -->
                    {% set unique_dates = sessions | map(attribute='session_date') | unique | list %}
                    {% for date in unique_dates[:7] %}
                    {% set session = sessions | selectattr('session_date', 'equalto', date) | first %}
                    <div class="calendar-day {% if loop.first %}selected{% endif %} {% if session.day_of_week in ['–°–ë', '–í–°'] %}weekend{% endif %}"
                         data-date="{{ date }}"
                         data-day-of-week="{{ session.day_of_week }}">
                        {{ date.day }}<br><small>{{ date.strftime('%b') }}</small>
                    </div>
                    {% endfor %}
                </div>

                <div class="time-slots">
                    <!-- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>

            <!-- Tickets Section -->
            <div class="tickets-section">
                <!-- Table Header -->
                <div class="tickets-header">
                    <div class="header-category">–ö–ê–¢–ï–ì–û–†–ò–Ø</div>
                    <div class="header-price">–°–¢–û–ò–ú–û–°–¢–¨</div>
                    <div class="header-quantity">–ö–û–õ–ò–ß–ï–°–¢–í–û</div>
                </div>

                {% for category in ticket_categories %}
                <div class="ticket-row">
                    <div class="ticket-info">
                        <div class="ticket-title">
                            {{ category.title }}
                            {% if category.pushkin_card_allowed %}
                            <img src="{{ url_for('static', filename='images/icon/pushkin-icon.png') }}" alt="–ü—É—à–∫–∏–Ω—Å–∫–∞—è –∫–∞—Ä—Ç–∞" class="pushkin-icon">
                            {% endif %}
                        </div>
                        {% if category.description %}
                        <div class="ticket-description">{{ category.description }}</div>
                        {% endif %}
                    </div>
                    <div class="ticket-price">{{ category.price }} ‚ÇΩ</div>
                    <div class="quantity-control">
                        <button class="quantity-btn" data-action="decrease" data-category-id="{{ category.id }}">‚àí</button>
                        <span class="quantity" data-category-id="{{ category.id }}">0</span>
                        <button class="quantity-btn" data-action="increase" data-category-id="{{ category.id }}">+</button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Right Section -->
        <div class="right-section">
            <div class="booking-panel">
                <div class="booking-info">
                    <div class="booking-header">–í—Ö–æ–¥–Ω–æ–π –±–∏–ª–µ—Ç</div>
                    <div class="museum-name">{{ museum.title_card }}</div>
                    <div class="booking-date" id="selected-datetime">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è</div>

                    <!-- –°–ø–∏—Å–æ–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤ -->
                    <div id="selected-tickets-list" style="margin-top: 10px;">
                        <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –±–∏–ª–µ—Ç—ã -->
                    </div>

                    <div class="price-display" id="total-price">= 0 ‚ÇΩ</div>
                </div>

                <button class="show-all-tickets" id="toggle-tickets-btn" style="display: none;">‚ñº –ü–û–ö–ê–ó–ê–¢–¨ –í–°–ï –ë–ò–õ–ï–¢–´</button>

                <div class="total-section">
                    <span>–ò–¢–û–ì–û:</span>
                    <span id="final-total">0 ‚ÇΩ</span>
                </div>

                <form id="order-form">
                    <input type="hidden" id="museum-id" name="museum_id" value="{{ museum.id }}">
                    <input type="hidden" id="selected-date" name="session_date">
                    <input type="hidden" id="selected-time" name="session_time">
                    <input type="hidden" id="tickets-data" name="tickets_data">

                    <div class="form-group">
                        <label class="form-label">–§–ê–ú–ò–õ–ò–Ø –ò–ú–Ø –û–¢–ß–ï–°–¢–í–û</label>
                        <input type="text" class="form-input" id="full-name" name="full_name" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">E-mail</label>
                        <input type="email" class="form-input" id="email" name="email" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <div style="display: flex; align-items: center; border: 1px solid #e0e0e0; border-radius: 4px; padding: 10px;">
                            <select id="country-code" name="country_code" style="border: none; outline: none; margin-right: 10px;">
                                <option value="+7">üá∑üá∫ +7</option>
                            </select>
                            <input type="tel" id="phone" name="phone" style="border: none; outline: none; flex: 1;" placeholder="9001234567" required>
                        </div>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox" id="subscribe" name="subscribe_news">
                        <label for="subscribe" class="checkbox-label">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –Ω–æ–≤–æ—Å—Ç–∏ –º—É–∑–µ—è</label>
                    </div>

                    <div class="checkbox-group" style="margin-bottom: 20px;">
                        <input type="checkbox" class="checkbox" id="agreement" name="accept_terms" checked required>
                        <label for="agreement" class="checkbox-label">
                            –ü–æ–∫—É–ø–∫–æ–π –±–∏–ª–µ—Ç–æ–≤ —è –≤—ã—Ä–∞–∂–∞—é —Å–≤–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ–º –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
                            –ø–æ–ª—É—á–µ–Ω–∏—è –ë–∏–ª–µ—Ç–∞ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é –ø–æ—á—Ç—É
                        </label>
                    </div>

                    <button type="submit" class="pay-button">–û–ü–õ–ê–¢–ò–¢–¨</button>
                </form>

                <div class="payment-info">
                    –û–ü–õ–ê–¢–ê –ü–£–®–ö–ò–ù–°–ö–û–ô –ö–ê–†–¢–û–ô<br>–ù–ï–î–û–°–¢–£–ü–ù–ê
                </div>
            </div>
        </div>
    </div>
    <!-- End Order Page Container -->

    <script>
        // –î–∞–Ω–Ω—ã–µ –æ –±–∏–ª–µ—Ç–∞—Ö –∏ —Ü–µ–Ω–∞—Ö
        const ticketPrices = {
            {% for category in ticket_categories %}
            {{ category.id }}: {{ category.price }},
            {% endfor %}
        };

        // –î–∞–Ω–Ω—ã–µ –æ –Ω–∞–∑–≤–∞–Ω–∏—è—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        const ticketNames = {
            {% for category in ticket_categories %}
            {{ category.id }}: "{{ category.title }}",
            {% endfor %}
        };

        // –î–∞–Ω–Ω—ã–µ –æ —Å–µ–∞–Ω—Å–∞—Ö –∏–∑ –ë–î
        const sessionsData = [
            {% for session in sessions %}
            {
                date: "{{ session.session_date }}",
                time: "{{ '%02d:%02d' % (session.session_time.seconds // 3600, (session.session_time.seconds % 3600) // 60) }}",
                available: {{ session.available_tickets }}
            },
            {% endfor %}
        ];

        let selectedDate = null;
        let selectedTime = null;
        let ticketQuantities = {};
        let ticketsExpanded = false;

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã
        document.querySelectorAll('.calendar-day').forEach(day => {
            day.addEventListener('click', function() {
                document.querySelectorAll('.calendar-day').forEach(d => d.classList.remove('selected'));
                this.classList.add('selected');
                selectedDate = this.getAttribute('data-date');
                selectedTime = null; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
                document.getElementById('selected-date').value = selectedDate;
                document.getElementById('selected-time').value = '';

                // –§–∏–ª—å—Ç—Ä—É–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∞ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã
                updateAvailableTimes();

                // –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—ã–±–æ—Ä –±–∏–ª–µ—Ç–æ–≤ –¥–æ –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏
                disableTicketSelection();

                updateBookingInfo();
            });
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤
        function updateAvailableTimes() {
            const timeSlotsContainer = document.querySelector('.time-slots');

            // –§–∏–ª—å—Ç—Ä—É–µ–º —Å–µ–∞–Ω—Å—ã –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç–µ
            const availableTimes = sessionsData.filter(session => session.date === selectedDate);

            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            timeSlotsContainer.innerHTML = '';

            // –°–æ–∑–¥–∞–µ–º —Å–ª–æ—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
            availableTimes.forEach((session, index) => {
                const timeSlot = document.createElement('div');
                timeSlot.className = 'time-slot';
                timeSlot.setAttribute('data-time', session.time);
                timeSlot.textContent = session.time;

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
                timeSlot.addEventListener('click', function() {
                    document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedTime = this.getAttribute('data-time');
                    document.getElementById('selected-time').value = selectedTime;

                    // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –≤—ã–±–æ—Ä –±–∏–ª–µ—Ç–æ–≤
                    enableTicketSelection();

                    updateBookingInfo();
                });

                timeSlotsContainer.appendChild(timeSlot);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤—ã–±–æ—Ä–∞ –±–∏–ª–µ—Ç–æ–≤
        function disableTicketSelection() {
            document.querySelectorAll('.quantity-btn').forEach(btn => {
                btn.disabled = true;
                btn.style.opacity = '0.5';
                btn.style.cursor = 'not-allowed';
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤—ã–±–æ—Ä–∞ –±–∏–ª–µ—Ç–æ–≤
        function enableTicketSelection() {
            document.querySelectorAll('.quantity-btn').forEach(btn => {
                btn.disabled = false;
                btn.style.opacity = '1';
                btn.style.cursor = 'pointer';
            });
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–∏–ª–µ—Ç–æ–≤
        document.querySelectorAll('.quantity-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—ã–±—Ä–∞–Ω–∞ –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
                if (!selectedDate || !selectedTime) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è —Å–µ–∞–Ω—Å–∞');
                    return;
                }

                const action = this.getAttribute('data-action');
                const categoryId = this.getAttribute('data-category-id');
                const quantitySpan = document.querySelector(`.quantity[data-category-id="${categoryId}"]`);
                let currentQuantity = parseInt(quantitySpan.textContent);

                if (action === 'increase') {
                    currentQuantity++;
                } else if (action === 'decrease' && currentQuantity > 0) {
                    currentQuantity--;
                }

                quantitySpan.textContent = currentQuantity;
                ticketQuantities[categoryId] = currentQuantity;
                updateBookingInfo();
            });
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –±–∏–ª–µ—Ç—ã"
        document.getElementById('toggle-tickets-btn').addEventListener('click', function() {
            ticketsExpanded = !ticketsExpanded;
            updateBookingInfo();
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
        function updateBookingInfo() {
            let totalTickets = 0;
            let totalPrice = 0;
            let selectedTicketsList = [];

            for (let categoryId in ticketQuantities) {
                const quantity = ticketQuantities[categoryId];
                if (quantity > 0) {
                    totalTickets += quantity;
                    const price = quantity * ticketPrices[categoryId];
                    totalPrice += price;
                    selectedTicketsList.push({
                        id: categoryId,
                        name: ticketNames[categoryId],
                        quantity: quantity,
                        price: price
                    });
                }
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤
            const ticketsListContainer = document.getElementById('selected-tickets-list');
            const toggleBtn = document.getElementById('toggle-tickets-btn');

            if (selectedTicketsList.length === 0) {
                ticketsListContainer.innerHTML = '<div style="color: #999; font-size: 14px; margin-top: 10px;">–ë–∏–ª–µ—Ç—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã</div>';
                toggleBtn.style.display = 'none';
            } else {
                let ticketsHTML = '';
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ 1 –±–∏–ª–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ - –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏
                const displayCount = ticketsExpanded ? selectedTicketsList.length : 1;

                for (let i = 0; i < displayCount; i++) {
                    const ticket = selectedTicketsList[i];
                    const ticketText = ticket.quantity === 1 ? '–±–∏–ª–µ—Ç' :
                                      ticket.quantity < 5 ? '–±–∏–ª–µ—Ç–∞' : '–±–∏–ª–µ—Ç–æ–≤';
                    ticketsHTML += `
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px; font-size: 14px;">
                            <div>
                                <div style="color: #333; font-weight: 500;">${ticket.name}</div>
                                <div style="color: #666; font-size: 12px;">${ticket.quantity} ${ticketText}</div>
                            </div>
                            <div style="color: #333; font-weight: 500;">${ticket.price} ‚ÇΩ</div>
                        </div>
                    `;
                }

                ticketsListContainer.innerHTML = ticketsHTML;

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±–∏–ª–µ—Ç–æ–≤ –±–æ–ª—å—à–µ 1
                if (selectedTicketsList.length > 1) {
                    toggleBtn.style.display = 'block';
                    toggleBtn.textContent = ticketsExpanded ? '‚ñ≤ –°–ö–†–´–¢–¨ –ë–ò–õ–ï–¢–´' : '‚ñº –ü–û–ö–ê–ó–ê–¢–¨ –í–°–ï –ë–ò–õ–ï–¢–´';
                } else {
                    toggleBtn.style.display = 'none';
                }
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â—É—é —Å—É–º–º—É
            document.getElementById('total-price').textContent = `= ${totalPrice} ‚ÇΩ`;
            document.getElementById('final-total').textContent = `${totalPrice} ‚ÇΩ`;

            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è
            if (selectedDate && selectedTime) {
                const dateObj = new Date(selectedDate);
                const dateStr = dateObj.toLocaleDateString('ru-RU');
                document.getElementById('selected-datetime').textContent = `${dateStr}, ${selectedTime}`;
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ –±–∏–ª–µ—Ç–∞—Ö –≤ —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ
            document.getElementById('tickets-data').value = JSON.stringify(ticketQuantities);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        document.getElementById('order-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
            if (!selectedDate || !selectedTime) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è —Å–µ–∞–Ω—Å–∞');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–±–æ—Ä–∞ –±–∏–ª–µ—Ç–æ–≤
            let totalTickets = 0;
            for (let categoryId in ticketQuantities) {
                totalTickets += ticketQuantities[categoryId];
            }
            if (totalTickets === 0) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –±–∏–ª–µ—Ç');
                return;
            }

            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
            const formData = new FormData(this);

            try {
                const response = await fetch('{{ url_for("create_order") }}', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    alert('–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω! –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞: ' + result.order_number);
                    // –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã –∏–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                    // window.location.href = '/order-confirmation/' + result.order_id;
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞: ' + result.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–∫–∞–∑–∞');
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—ã–±–æ—Ä –±–∏–ª–µ—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            disableTicketSelection();

            // –ï—Å–ª–∏ –µ—Å—Ç—å –ø–µ—Ä–≤–∞—è –¥–∞—Ç–∞, –≤—ã–±–∏—Ä–∞–µ–º –µ—ë
            const firstDate = document.querySelector('.calendar-day.selected');
            if (firstDate) {
                selectedDate = firstDate.getAttribute('data-date');
                document.getElementById('selected-date').value = selectedDate;
                updateAvailableTimes();
            }

            updateBookingInfo();
        });
    </script>

{% endblock %}